---
/**
 * 圣诞彩灯装饰组件
 * 悬挂在 Header 底部的装饰性彩灯，随 Header 一起移动
 */

// 灯泡数量：覆盖最大屏幕宽度 (灯泡间距约 52px，50 个足够覆盖 2600px+)
const lightCount = 50;
---

<ul class="lightrope" aria-hidden="true">
  {Array.from({ length: lightCount }).map(() => <li />)}
</ul>

<style>
  .lightrope {
    --globe-width: 12px;
    --globe-height: 28px;
    --globe-spacing: 40px;
    --globe-spread: 3px;
    --light-off-opacity: 0.4;

    /* 圣诞配色 */
    --light-red: 185, 50, 50;
    --light-green: 34, 139, 34;
    --light-gold: 218, 165, 32;

    position: absolute;
    top: calc(100% - 20px);
    left: 0;
    width: 100%;
    margin: 0;
    padding: 0;
    text-align: center;
    white-space: nowrap;
    overflow-x: clip;
    overflow-y: visible;
    pointer-events: none;
  }

  .lightrope li {
    position: relative;
    display: inline-block;
    width: var(--globe-width);
    height: var(--globe-height);
    margin: calc(var(--globe-spacing) / 2);
    padding: 0;
    list-style: none;
    border-radius: 50%;
    background: rgb(var(--light-red));
    box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-red), 1);
    animation: flash-red 2s ease-in-out infinite;
    animation-fill-mode: both;
    will-change: box-shadow, background;
  }

  /* 绿色灯泡 - 每隔一个 */
  .lightrope li:nth-child(2n + 1) {
    background: rgb(var(--light-green));
    box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-green), 0.5);
    animation-name: flash-green;
    animation-duration: 0.4s;
  }

  /* 金色灯泡 - 每 4 个中的第 2 个 */
  .lightrope li:nth-child(4n + 2) {
    background: rgb(var(--light-gold));
    box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-gold), 1);
    animation-name: flash-gold;
    animation-duration: 1.1s;
  }

  /* 动画时长变化 - 创造随机感 */
  .lightrope li:nth-child(odd) {
    animation-duration: 1.8s;
  }

  .lightrope li:nth-child(3n + 1) {
    animation-duration: 1.4s;
  }

  /* 灯座 */
  .lightrope li::before {
    content: '';
    position: absolute;
    top: calc(0px - var(--globe-height) / 6);
    left: 1px;
    width: calc(var(--globe-width) - 2px);
    height: calc(var(--globe-height) / 3);
    background: hsl(var(--background) / 0.6);
    border-radius: 3px;
  }

  /* 连接电线 */
  .lightrope li::after {
    content: '';
    position: absolute;
    top: calc(0px - var(--globe-height) / 2);
    left: calc(var(--globe-width) - 3px);
    width: calc(var(--globe-spacing) + 12px);
    height: calc(var(--globe-height) / 3 * 2);
    border-bottom: solid hsl(var(--background) / 0.6) 2px;
    border-radius: 50%;
  }

  /* 最后一个灯泡不需要连接线 */
  .lightrope li:last-child::after {
    content: none;
  }

  /* 第一个灯泡左移，隐藏左边缘 */
  .lightrope li:first-child {
    margin-left: calc(0px - var(--globe-spacing));
  }

  /* 红色闪烁 */
  @keyframes flash-red {
    0%,
    100% {
      background: rgb(var(--light-red));
      box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-red), 1);
    }
    50% {
      background: rgba(var(--light-red), var(--light-off-opacity));
      box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-red), 0.2);
    }
  }

  /* 绿色闪烁 */
  @keyframes flash-green {
    0%,
    100% {
      background: rgb(var(--light-green));
      box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-green), 1);
    }
    50% {
      background: rgba(var(--light-green), var(--light-off-opacity));
      box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread)
        rgba(var(--light-green), 0.2);
    }
  }

  /* 金色闪烁 */
  @keyframes flash-gold {
    0%,
    100% {
      background: rgb(var(--light-gold));
      box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread) rgba(var(--light-gold), 1);
    }
    50% {
      background: rgba(var(--light-gold), var(--light-off-opacity));
      box-shadow: 0px calc(var(--globe-height) / 6) calc(var(--globe-width) * 2) var(--globe-spread)
        rgba(var(--light-gold), 0.2);
    }
  }

  /* 无障碍：减少动画 */
  @media (prefers-reduced-motion: reduce) {
    .lightrope li {
      animation: none;
    }
  }

  /* 根据 christmas 状态控制显示/隐藏 */
  :global(html:not(.christmas)) .lightrope {
    opacity: 0;
    transform: translateY(-40px);
    pointer-events: none;
  }

  .lightrope {
    transition:
      opacity 0.3s ease-out,
      transform 0.3s ease-out;
  }

  @media (prefers-reduced-motion: reduce) {
    .lightrope {
      transition: none;
    }
  }
</style>
